!function(t,e){"function"==typeof define&&define.amd?define(["jQuery"],e):"object"==typeof module&&module.exports?module.exports=e(require("jQuery")):t.Truncate=e(t.jQuery)}(this,function(t){function e(t){return t.replace(/\s*$/,"")}function i(t,e){if(t.innerText)t.innerText=e;else if(t.nodeValue)t.nodeValue=e;else{if(!t.textContent)return!1;t.textContent=e}}function n(t,e,n,s){var o,h=t.parent();t.remove();var l=n?n.length:0;if(h.contents().length>l)return o=h.contents().eq(-1-l),r(o,e,n,s);var a=h.prev();return o=a.contents().eq(-1),!!o.length&&(i(o[0],o.text()+s.ellipsis),h.remove(),n.length&&a.append(n),!0)}function s(t,s,o,h){for(var r,l,a=t[0],p=t.text(),d="",c=0,u=p.length;c<=u;)r=c+(u-c>>1),l=h.ellipsis+e(p.substr(r-1,p.length)),i(a,l),s.height()>h.maxHeight?c=r+1:(u=r-1,d=d.length>l.length?d:l);return d.length>0?(i(a,d),!0):n(t,s,o,h)}function o(t,s,o,h){for(var r,l,a=t[0],p=t.text(),d="",c=0,u=p.length;c<=u;)r=c+(u-c>>1),l=e(p.substr(0,r-2))+h.ellipsis,i(a,l),s.height()>h.maxHeight?u=r-1:(c=r+1,d=d.length>l.length?d:l);return d.length>0?(i(a,d),!0):n(t,s,o,h)}function h(t,s,o,h){for(var r,l,a=t[0],p=t.text(),d="",c=0,u=p.length,g=u>>1;c<=g;)r=c+(g-c>>1),l=e(p.substr(0,r))+h.ellipsis+p.substr(u-r,u-r),i(a,l),s.height()>h.maxHeight?g=r-1:(c=r+1,d=d.length>l.length?d:l);return d.length>0?(i(a,d),!0):n(t,s,o,h)}function r(t,e,i,n){return"end"===n.position?o(t,e,i,n):"start"===n.position?s(t,e,i,n):h(t,e,i,n)}function l(e,i,n,s){var o,h,l=e[0],a=e.contents(),d=a.length,u=d-1,g=!1;for(e.empty();u>=0&&!g;u--)o=a.eq(u),h=o[0],8!==h.nodeType&&(l.insertBefore(h,l.firstChild),n.length&&(t.inArray(l.tagName.toLowerCase(),c)>=0?e.after(n):e.append(n)),i.height()>s.maxHeight&&(g=3===h.nodeType?r(o,i,n,s):p(o,i,n,s)),!g&&n.length&&n.remove());return g}function a(e,i,n,s){var o,h,l=e[0],a=e.contents(),d=0,u=a.length,g=!1;for(e.empty();d<u&&!g;d++)o=a.eq(d),h=o[0],8!==h.nodeType&&(l.appendChild(h),n.length&&(t.inArray(l.tagName.toLowerCase(),c)>=0?e.after(n):e.append(n)),i.height()>s.maxHeight&&(g=3===h.nodeType?r(o,i,n,s):p(o,i,n,s)),!g&&n.length&&n.remove());return g}function p(t,e,i,n){return"end"===n.position?a(t,e,i,n):"start"===n.position?l(t,e,i,n):a(t,e,i,n)}function d(e,i){this.element=e,this.$element=t(e),this._name="truncate",this._defaults={lines:1,ellipsis:"â€¦",showMore:"",showLess:"",position:"end",lineHeight:"auto"},this.config(i),this.original=this.cached=e.innerHTML.trim(),this.isTruncated=!1,this.isCollapsed=!0,this.update()}var c=["table","thead","tbody","tfoot","tr","col","colgroup","object","embed","param","ol","ul","dl","blockquote","select","optgroup","option","textarea","script","style"];return d.prototype={config:function(e){if(this.options=t.extend({},this._defaults,e),"auto"===this.options.lineHeight){var i=this.$element.css("line-height"),n=18;"normal"!==i&&(n=parseInt(i,10)),this.options.lineHeight=n}void 0===this.options.maxHeight&&(this.options.maxHeight=parseInt(this.options.lines,10)*parseInt(this.options.lineHeight,10)),"start"!==this.options.position&&"middle"!==this.options.position&&"end"!==this.options.position&&(this.options.position="end"),this.$clipNode=t(t.parseHTML(this.options.showMore),this.$element),this.original&&this.update()},update:function(t){var e=!this.isCollapsed;"undefined"!=typeof t?this.original=this.element.innerHTML=t.trim():this.isCollapsed&&this.element.innerHTML.trim()===this.cached&&(this.element.innerHTML=this.original);var i=this.$element.wrapInner("<div/>").children();i.css({border:"none",margin:0,padding:0,width:"auto",height:"auto","word-wrap":"break-word"}),this.isTruncated=!1,i.height()>this.options.maxHeight?(this.isTruncated=p(i,i,this.$clipNode,this.options),this.isExplicitlyCollapsed&&(this.isCollapsed=!0,e=!1)):this.isCollapsed=!1,i.replaceWith(i.contents()),this.cached=this.element.innerHTML.trim(),e&&(this.element.innerHTML=this.original)},expand:function(){var t=!0;this.isExplicitlyCollapsed&&(this.isExplicitlyCollapsed=!1,t=!1),this.isCollapsed&&(this.isCollapsed=!1,this.element.innerHTML=this.isTruncated?this.original+(t?this.options.showLess:""):this.original)},collapse:function(t){this.isExplicitlyCollapsed=!0,this.isCollapsed||(this.isCollapsed=!0,t=t||!1,t?this.update():this.element.innerHTML=this.cached)},retruncate:function(){!this.isCollapsed;this.isCollapsed&&this.element.innerHTML.trim()===this.cached&&(this.element.innerHTML=this.original);var t=this.$element.wrapInner("<div/>").children();t.css({border:"none",margin:0,padding:0,width:"auto",height:"auto","word-wrap":"break-word"}),this.isTruncated=!1,t.height()>this.options.maxHeight?(this.isTruncated=p(t,t,this.$clipNode,this.options),this.isTruncated&&(this.isCollapsed=!0)):this.isCollapsed=!1,t.replaceWith(t.contents()),this.cached=this.element.innerHTML.trim()}},t.fn.truncate=function(e){var i=t.makeArray(arguments).slice(1);return this.each(function(){var n=t.data(this,"jquery-truncate");n?"function"==typeof n[e]&&n[e].apply(n,i):t.data(this,"jquery-truncate",new d(this,e))})},d});